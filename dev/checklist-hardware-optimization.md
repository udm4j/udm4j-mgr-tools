Чеклист оптимизации КТС
===========

<a name="infra">Инфраструктура</a>
-----------
1. Отказ от Sentry (сервис + бд)
2. Отказ от мониторинга (grafana + prometheus) 
3. Отказ от gateway / apim (сервис + бд)
4. Отказ от imgproxy (масштабирование картинок) (сервис)
5. Отказ от hasura-as-scheduler, hasura-as-gateway, hasura-as-adapter  (3 сервиса + 2 бд)
6. Отказ от/выключение файлового сервиса
* отказ от S3 (бд)
* отказ от сервиса репликации файлов (сервис)
* отказ от касперского (сервис + бд)
7. Отказ от/выключение драфт-сервиса (черновики, умеют писать в локальное хранилище) (сервис + бд)
8. Отказ от mongoDB (бд) 
9. Отказ от clickhouse (аналитика, отчеты) (бд)
10. Отказ от debezium (сервис)
11. Отказ от репликации сервисов (сервис)    
12. Отказ от георезерва
13. Перейти на новую версию kafka без zookeeper (сервис + бд)
14. Отказ от elastic (сервис + бд)

<a name="infra">Хранилища</a>
-----------
1. Объединить все инстансы базы данных в один (кластеры, субд, схемы, балансировщики, реплики)
2. Определить список таблиц-журналов, зафиксировать для каждой глубину хранения истории, реализовать регулярную очистку данных, старше этой глубины.
* хранилища бизнес-данных (postgres, clickhouse, mongo)
* хранилища логов (elastic)
* хранилища метрик (prometheus)
* хранилища файлов (s3, nfs)
* промежуточные хранилища (kafka, mq)
3. Очистка данных
* Заменить uuid-PK на bigserial (bigint)
* Заменить натуральных ключи на суррогатные
* Вынести повторяющиеся классификаторы в самостоятельные справочники (замена значений ссылками)
* Удалить неиспользуемые и задублированные индексы и другие объекты бд
* Удалить старых неиспользуемые таблицы (z_%, %_old, etc)
* Вынести большие хранимые объекты в файловый сервис (по возможности).
4. Ограничения и контроль
* запрет на загрузку файлов (max_body_size, TTL, limit-per-product, limit-per-user)
* настроить сжатие/архивирование 
5. Отказ от хранения бекапов

<a name="services">Сервисы</a>
-----------
1. Уменьшить выделенные ресурсы в соответствии с минимальными рекомендациями из карточек сервисов или [сводной статьёй](https://confluence.pcbltools.ru/confluence/pages/viewpage.action?pageId=12735015)
2. Отключить кэш в приложениях (требование: любой кэш должен быть отключаем)
3. Отключить необязательные сервисы
* Клиент сервиса аудита умеет писать в лог. Поэтому для целей разработки/отладки сервис можно отключить
* Клиент сервиса интеграционного лога умеет писать в лог. Поэтому для целей разработки/отладки сервис можно отключить
* Клиент сервиса авторизации умеет отключать проверку. Поэтому для целей разработки/отладки сервис можно отключить
* Отключить все интеграции, импорт/экспорт данных, ЭОР (Электронный Образовательный Ресурс)
4. Минимизировать и оптимизировать хранение и поставку фронтенд-сервисов, поставку бекенд-сервисов
5. Настроить rate limit на пользовательские действия 

<a name="functions">Функциональность</a>
-----------
* Отказ от функционала "регистрация директора" и "Интеграция с КЦОК" (сервис + бд) (???)
* Отказ от функционала геймификации (сервис + бд)
* Отказ от сервиса обезлички для ml (сервис)
* Отказ от сервиса баннеров (сервис + бд)
* Отказ от сервиса команд (сервис + бд)
